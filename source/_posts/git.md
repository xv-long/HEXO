---
title: git
date: 2023-02-13 20:26:04
tags:
---

---

终端操作代码操作指令

---

## git 基本指令

**workspace** **工作区**正在写代码的区域

**index stage** **暂存区**已完成的工作可以提交到临时存放区域

**Repository** **本地仓库**本地最终的存放区域

**Remote** **远程仓库**网上备份（防止本地仓库丢失）

### 上传信息

**上传用户名**

```bash
git config --global user.name "用户名"
```

**上传邮箱**

```bash
git config --global user.email"邮箱号"
```

### 创建 本地 仓库

#### **第一步：初始化 git 仓库**

```bash
git init 初始化 git 仓库

```

#### **第二步：将文件添加到暂存区**

```bash
git add . (把当前目录下的所有文件都添加到暂存区)

git add 文件 （添加单个文件）
```

#### **第三步：将文件从暂存区添加到本地仓库**

```bash
git commit -m"备注" （备注一般写本次修改所完成的功能或解决的 bug）
```

**作用：**该命令把暂存区里的内容挪到了 git 仓库中

### 指令

git init 初始化 git 仓库

---

git status -s 查看文件状态

---

git log 只显示有效的 commit 日志（每次 commit 都会生成一个 log 日志，记录这次提交的 id、日期、备注等）

---

提示：如果 log 日志比较多时会显示不全，按上下键可以查看。退出按 q 键

---

git reflog 显示所有的操作记录

---

git branch 查看所有的本地分支列表

---

git reset [--soft 或--hard] commit_id （commit_id 为版本编号，不需要写全，写五六位即可）**撤回回退**

    1.  --hard 硬回撤：像时间穿梭一样彻底回到历史某个版本，工作区里的代码也变回到回撤后版本的代码（HEAD 指向了回撤后的版本）

    2.  --soft 软回撤：只是回撤了本次提交而已，工作区里的代码不变（HEAD 指向不变）.

---

**注意：**刚初始化的 git 仓库没有分支，只需 commit 一次即可自动创建 master 分支

---

git branch 新的分支名字 查看所有的本地分支列表

**注意：**新创建的分支是基于当前分支创建出来的，所以新分支中的代码和当前分支完全一样

---

git checkout 分支名称 切换分支

**注意：**如果切换分支时当前分支有未 commit 的代码，则会把没有 commit 的代码带到新分支上。

---

git merge 分支名称 -m"备注" 将<分支名称>合并到当前分支上

注意：假设要把 C 分支的代码合并到 A 分支，则必须**先切换到 A 分支**上，**再运行 git merge 命令**，来合并 C 分支！

---

git branch -d 分支名称 （-d 是 delete 的缩写） 删除该分支

**注意：**

1. 要删除某个分支，当前分支不能是该分支

2. 如果要删除的分支有没 merge 的代码，则会提示不能删除。如果非要删除请使用：git branch -D 分支名称 （-D 表示强制删除）

---

**如果不想这样**，**有两种方法可以解决：**

1. 先把当前分支上的所有代码都 commit 之后再切换分支

2. 使用 git stash 把没有 commit 的所有代码暂存起来

**暂存命令**：

git stash 把没有 commit 的所有内容暂存起来

git stash pop 从暂存区里取出上一次暂存的内容

---

git stash list 显示所有暂存的列表

git stash pop stash@{id} 从暂存区里取出指定的一次暂存内容

1. 如果没有 id，则取出最新一次；
2. 2.同时从 list 中删除对应的暂存 id 以及内容）

git stash apply stash@{id} 从暂存区里取出指定的一次暂存内容

1. 如果没有 id，则取出最新一次；
2. 继续保留该暂存的 id 以及内容

git stash drop <stash@{id}> 从暂存区里删除指定的一次暂存内容

1. 如果没有 id，则删除最新一次

git stash clear 清除所有暂存内容

---

**第一步：生成 SSH 的公钥和私钥**
ssh-keygen -t rsa -b 4096 -C "备注" （备注一般写自己的邮箱）
连续敲击 3 次回车，即可生成 id_rsa（私钥） 和 id_rsa.pub（公钥） 两个文件

---

---

### 简化 push 命令

**把远程仓库的网址保存到一个 git 变量里**

git pull 远程仓库 远程分支名:本地分支名

---

git remote add 变量名 远程仓库网址 工作中变量名一般用**origin（译：源头）**

---

git remote -vv 查看所有"变量"

---

git remote rm 变量名 删除该"变量"

---

如果本地分支和远程分支名相同，只写一个即可**（强烈推荐相同）**

---

**把一个本地分支和一个远程分支进行关联**

git branch --set-upstream-to=远程仓库/远程分支名 本地分支名 单独添加关联

---

git push -u origin 本地分支名:远程分支名 push 的时候顺便关联

---

git branch -vv 查看所有分支的关联情况

---

git branch -r 查看远程分支：

---

git branch -a 查看所有分支：

---

当我们使用 git push 时，会在.git 文件里备份一个远程仓库。所以通过 git branch -r 看到的不是服务器的远程仓库，而是.git 文件里的远程仓库（验证：断网执行 git branch -r）

---

** git push 远程仓库 --delete 远程分支名 把.git 文件里的和服务器里的远程分支一起都删除了**

---

---

### **从远程仓库往本地拉代码分三种情况：**

1. 本地没有仓库时（即没有.git 文件夹）： git clone 远程仓库

   1. 把所有远程分支及代码都克隆到本地；
   2. 还创建了 origin 变量；
   3. 关联本地和远程 master 分支

---

2. 本地有仓库，但没有该分支：

   1. 先 git fetch # 将远程仓库里的所有分支及代码全部克隆到**.git 文件里的远程仓库** （不能断网，是从服务器往本地拉代码）
   2. 然后 git checkout -b 本地分支名 远程仓库/远程分支名

   从**.git 文件里的远程仓库里**把该分支的代码捡出到**本地仓库和工作区**可以断网）

---

3. 本地有仓库，也有该分支，有两种方法：（这两种方法等价： fetch + merge === pull ）

   1. 先 git fetch，然后 git merge 远程仓库/远程分支名

      ​ 从.git 文件里的远程仓库里把该分支 merge 到当前分支

   2. git pull 远程仓库 远程分支名:本地分支名

   3. 如果当前分支和远程分支关联了，则可以简写为：git pull

---

git checkout -- 文件 或 . （. 表示所有的文件） 用**暂存区**或**仓库**中的代码**覆盖工作区**的代码（即：如果暂区有代码，则用暂存区的代码覆盖工作区的代码；如果暂存区没有代码，则用仓库中的代码覆盖工作区的代码）

---

用户修改了工作区中的代码，而且已经 git add 添加到暂存区了。现在要回撤这次某个文件的修改

第一步：git reset HEAD 文件

作用：仅仅只是回撤 git add（可以理解为：删除了暂存区里的代码），工作区的代码并没有任何变化

---

第二步： git checkout -- 文件

作用：由于暂存区已经没有代码了，所以会自动用**仓库**中的代码**覆盖工作区**的代码

---

**工作中真实需求：线上产品出了 bug，而且短时间内解决不了，需要回滚到上一个版本**

**回撤解决办法：**

1. 第一步：git log，然后复制对应的 commit_id

2. 第二步： git reset --hard commit_id

3. 第三步：git push

---

由于操作失误，回滚到上上一个版本了，怎么办？别怕，还能再找回\*（硬回撤后仓库里的代码和提交信息其实并**没有真的删除，只是不显示了而已）**

解决办法：

1. 第一步： git reflog，然后复制对应的 commit_id **（git log 只显示有效的 commit 日志；git reflog 显示所有的操作记录）**

2. 第二步：git reset --hard commit_id

3. 第三步：git push

### 忽略文件追踪

```
一般我们总会有些文件无需纳入 Git 的管理，也不希望它们总出现在未跟踪文件列表。 在这种情况下，我们可

以创建一个名为 .gitignore 的配置文件，列出要忽略的文件的匹配模式。文件 .gitignore 的格式规范如下：
1. 以  #  开头的是注释
2. 以  /  结尾的是目录
3. 以  /  开头防止递归
4. 以  !  开头表示取反
5. 可以使用 glob 模式进行文件和文件夹的匹配 （glob 模式其实就是简化了的正则表达式）
   1. *星号  * 匹配零个或多个任意字符
   2. [abc]  匹配任何一个列在方括号中的字符（此案例匹配一个 a 或匹配一个 b 或匹配一个 c）
   3. 问号 ? 只匹配一个任意字符
   4. 两个星号 **  表示匹配任意中间目录*（比如 a/\*\*/z 可以匹配 a/z 、 a/b/z 或 a/b/c/z 等）

```
